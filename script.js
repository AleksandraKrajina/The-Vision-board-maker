const translations = {
  sr: {
    brand: 'âœ¨ Vision Board Maker',
    languageLabel: 'Jezik',
    ctaStart: 'Kreni da kreiraÅ¡',
    heroEyebrow: 'Prava girly app energija ðŸ’—',
    heroTitle: 'Kreiraj svoj dream visual board bez skidanja slika',
    heroDesc: 'Dodaj Pinterest ili Google linkove, ubaci slike sa lokalne maÅ¡ine, grupiÅ¡i ciljeve po kategorijama i preuzmi board u veliÄini za telefon, tablet, laptop ili digitalnu Å¡tampu (A1/A2).',
    ctaCreator: 'Idi na kreator',
    preview1: 'Travel mood board',
    preview2: 'Career & money glow up',
    preview3: 'Love & self-care vision',
    preview4: 'A1 print edition',
    whyTitle: 'ZaÅ¡to visual board?',
    whyP1: 'Visual board pomaÅ¾e da tvoji ciljevi postanu vidljivi svaki dan. Umesto da ideje ostanu u glavi, vidiÅ¡ ih na ekranu ili odÅ¡tampane i lakÅ¡e ostajeÅ¡ fokusirana na ono Å¡to ti je vaÅ¾no.',
    whyP2: 'Ovaj alat je napravljen da maksimalno skrati pripremu: ne moraÅ¡ da skidaÅ¡ slike, samo nalepiÅ¡ URL ili uploadujeÅ¡ lokalno. Posle toga ih brzo rasporediÅ¡ u kategorije poput putovanja, posla, ljubavi i centralne STAR sekcije.',
    t1Title: 'Tutorijal 1: DefiniÅ¡i fokus',
    t1P1: 'Odaberi 3-5 glavnih tema koje Å¾eliÅ¡ da manifestujeÅ¡ ove godine i napiÅ¡i kratak razlog za svaku temu.',
    t1P2: 'Time Ä‡eÅ¡ lakÅ¡e birati slike koje stvarno podrÅ¾avaju tvoj cilj i emociju koju Å¾eliÅ¡ da oseÄ‡aÅ¡.',
    t2Title: 'Tutorijal 2: Skupljanje inspiracije',
    t2P1: 'PronaÄ‘i slike na Pinterestu ili Google-u i ubaci ih preko linka bez dodatnog skidanja na raÄunar.',
    t2P2: 'Kombinuj reference, quote poruke i lifestyle fotografije kako bi board bio i lep i motiviÅ¡uÄ‡i.',
    t3Title: 'Tutorijal 3: Raspored i export',
    t3P1: 'Smesti STAR slike u centar, a ostale po kategorijama pa preuzmi board u Å¾eljenom formatu.',
    t3P2: 'Napravi verziju za telefon, laptop i Å¡tampu da tvoja motivacija bude uz tebe tokom celog dana.',
    benefitsTitle: 'ZaÅ¡to baÅ¡ ova app?',
    benefitsP1: 'Zato Å¡to ti olakÅ¡ava ceo proces: ne moraÅ¡ da ÄuvaÅ¡ slike lokalno da bi ih koristila, samo nalepiÅ¡ link i odmah radiÅ¡ sa njima u board-u.',
    benefitsP2: 'Fokus ostaje na kreativnom delu i nalaÅ¾enju inspiracije, dok app preuzima tehniÄki deo organizacije, grupisanja i podeÅ¡avanja dimenzija za razliÄite ureÄ‘aje i print formate.',
    ctaNow: 'PoÄni kreiranje sada',
    backLanding: 'â† Nazad na landing',
    creatorTitle: 'Vision board kreator',
    connectWallet: 'PoveÅ¾i wallet',
    walletDisconnected: 'Wallet nije povezan',
    walletNotFound: 'Web3 wallet nije pronaÄ‘en (instaliraj MetaMask).',
    walletCanceled: 'Povezivanje otkazano.',
    walletConnected: 'Povezano',
    boardSettings: 'PodeÅ¡avanja board-a',
    sizeLabel: 'VeliÄina board-a',
    sizeLaptop: 'Laptop (1920x1080)',
    sizeTablet: 'Tablet (2048x1536)',
    sizePhone: 'Telefon (1170x2532)',
    sizeA1: 'A1 digital print (7016x9933)',
    sizeA2: 'A2 digital print (4961x7016)',
    categoryLabel: 'Kategorija',
    catTravel: 'Putovanja',
    catWork: 'Posao',
    catLove: 'Ljubav',
    catStar: 'STAR (centar)',
    catStarShort: 'STAR',
    urlLabel: 'URL slike (Pinterest/Google)',
    addLink: 'Dodaj sa linka',
    localLabel: 'Ili dodaj sa raÄunara',
    downloadBoard: 'Preuzmi screenshot board-a',
    goalGroups: 'Grupe ciljeva',
    boardPlaceholder: 'Ovde Ä‡e se pojaviti tvoje slike âœ¨',
    imageUrlPlaceholder: 'https://...'
  },
  en: {
    brand: 'âœ¨ Vision Board Maker',
    languageLabel: 'Language',
    ctaStart: 'Start creating',
    heroEyebrow: 'Ultimate girly app energy ðŸ’—',
    heroTitle: 'Create your dream vision board without downloading images',
    heroDesc: 'Add Pinterest or Google links, upload local images, group goals by category, and export boards for phone, tablet, laptop, or digital print (A1/A2).',
    ctaCreator: 'Go to creator',
    preview1: 'Travel mood board',
    preview2: 'Career & money glow up',
    preview3: 'Love & self-care vision',
    preview4: 'A1 print edition',
    whyTitle: 'Why a vision board?',
    whyP1: 'A vision board makes your goals visible every day. Instead of keeping ideas only in your head, you see them on your screen or printed and stay focused on what matters most.',
    whyP2: 'This tool shortens preparation: no need to download images first. Just paste a URL or upload locally, then quickly arrange them into categories like travel, work, love, and the central STAR section.',
    t1Title: 'Tutorial 1: Define your focus',
    t1P1: 'Pick 3-5 key themes you want to manifest this year and write a short reason for each.',
    t1P2: 'That way you can choose visuals that truly support your goal and desired feeling.',
    t2Title: 'Tutorial 2: Gather inspiration',
    t2P1: 'Find images on Pinterest or Google and add them directly via link without extra local downloads.',
    t2P2: 'Mix references, quote cards, and lifestyle photos so your board is both beautiful and motivating.',
    t3Title: 'Tutorial 3: Layout and export',
    t3P1: 'Place STAR images in the center, organize others by category, then export in your preferred format.',
    t3P2: 'Create versions for phone, laptop, and print so your motivation stays with you all day.',
    benefitsTitle: 'Why use this app?',
    benefitsP1: 'It makes the whole process easier: you do not need to save images locally just to use themâ€”paste a link and use them instantly in your board.',
    benefitsP2: 'You stay focused on creativity and image discovery while the app handles organization, grouping, and sizing for different devices and print formats.',
    ctaNow: 'Start creating now',
    backLanding: 'â† Back to landing',
    creatorTitle: 'Vision board creator',
    connectWallet: 'Connect wallet',
    walletDisconnected: 'Wallet not connected',
    walletNotFound: 'Web3 wallet not found (install MetaMask).',
    walletCanceled: 'Connection canceled.',
    walletConnected: 'Connected',
    boardSettings: 'Board settings',
    sizeLabel: 'Board size',
    sizeLaptop: 'Laptop (1920x1080)',
    sizeTablet: 'Tablet (2048x1536)',
    sizePhone: 'Phone (1170x2532)',
    sizeA1: 'A1 digital print (7016x9933)',
    sizeA2: 'A2 digital print (4961x7016)',
    categoryLabel: 'Category',
    catTravel: 'Travel',
    catWork: 'Work',
    catLove: 'Love',
    catStar: 'STAR (center)',
    catStarShort: 'STAR',
    urlLabel: 'Image URL (Pinterest/Google)',
    addLink: 'Add from link',
    localLabel: 'Or upload from computer',
    downloadBoard: 'Download board screenshot',
    goalGroups: 'Goal groups',
    boardPlaceholder: 'Your images will appear here âœ¨',
    imageUrlPlaceholder: 'https://...'
  },
  de: {
    brand: 'âœ¨ Vision Board Maker',
    languageLabel: 'Sprache',
    ctaStart: 'Jetzt erstellen',
    heroEyebrow: 'Echte Girly-App-Energie ðŸ’—',
    heroTitle: 'Erstelle dein Traum-Vision-Board ohne Bilder herunterzuladen',
    heroDesc: 'FÃ¼ge Pinterest- oder Google-Links hinzu, lade lokale Bilder hoch, gruppiere Ziele nach Kategorien und exportiere Boards fÃ¼r Handy, Tablet, Laptop oder Digitaldruck (A1/A2).',
    ctaCreator: 'Zum Creator',
    preview1: 'Reise-Moodboard',
    preview2: 'Karriere & Money Glow-up',
    preview3: 'Liebe & Self-Care Vision',
    preview4: 'A1 Druck-Edition',
    whyTitle: 'Warum ein Vision Board?',
    whyP1: 'Ein Vision Board macht deine Ziele jeden Tag sichtbar. Statt Ideen nur im Kopf zu behalten, siehst du sie auf dem Bildschirm oder ausgedruckt und bleibst fokussiert.',
    whyP2: 'Dieses Tool verkÃ¼rzt die Vorbereitung: Du musst Bilder nicht vorher herunterladen. Einfach URL einfÃ¼gen oder lokal hochladen und dann schnell in Kategorien wie Reisen, Arbeit, Liebe und die zentrale STAR-Sektion einordnen.',
    t1Title: 'Tutorial 1: Fokus definieren',
    t1P1: 'WÃ¤hle 3-5 Hauptthemen, die du dieses Jahr manifestieren mÃ¶chtest, und notiere einen kurzen Grund.',
    t1P2: 'So wÃ¤hlst du Bilder, die dein Ziel und dein gewÃ¼nschtes GefÃ¼hl wirklich unterstÃ¼tzen.',
    t2Title: 'Tutorial 2: Inspiration sammeln',
    t2P1: 'Finde Bilder auf Pinterest oder Google und fÃ¼ge sie direkt per Link hinzu â€“ ohne extra Download.',
    t2P2: 'Kombiniere Referenzen, Zitatkarten und Lifestyle-Fotos, damit dein Board schÃ¶n und motivierend ist.',
    t3Title: 'Tutorial 3: Layout und Export',
    t3P1: 'Platziere STAR-Bilder in der Mitte, ordne den Rest nach Kategorien und exportiere im gewÃ¼nschten Format.',
    t3P2: 'Erstelle Versionen fÃ¼r Handy, Laptop und Druck, damit deine Motivation dich den ganzen Tag begleitet.',
    benefitsTitle: 'Warum diese App?',
    benefitsP1: 'Sie macht den ganzen Prozess einfacher: Du musst Bilder nicht lokal speichern, um sie zu nutzen â€“ Link einfÃ¼gen und direkt im Board verwenden.',
    benefitsP2: 'Du konzentrierst dich auf KreativitÃ¤t und Inspiration, wÃ¤hrend die App Organisation, Gruppierung und GrÃ¶ÃŸenanpassung fÃ¼r GerÃ¤te und Druck Ã¼bernimmt.',
    ctaNow: 'Jetzt loslegen',
    backLanding: 'â† ZurÃ¼ck zur Landingpage',
    creatorTitle: 'Vision-Board Creator',
    connectWallet: 'Wallet verbinden',
    walletDisconnected: 'Wallet nicht verbunden',
    walletNotFound: 'Web3-Wallet nicht gefunden (MetaMask installieren).',
    walletCanceled: 'Verbindung abgebrochen.',
    walletConnected: 'Verbunden',
    boardSettings: 'Board-Einstellungen',
    sizeLabel: 'Board-GrÃ¶ÃŸe',
    sizeLaptop: 'Laptop (1920x1080)',
    sizeTablet: 'Tablet (2048x1536)',
    sizePhone: 'Telefon (1170x2532)',
    sizeA1: 'A1 Digitaldruck (7016x9933)',
    sizeA2: 'A2 Digitaldruck (4961x7016)',
    categoryLabel: 'Kategorie',
    catTravel: 'Reisen',
    catWork: 'Arbeit',
    catLove: 'Liebe',
    catStar: 'STAR (Mitte)',
    catStarShort: 'STAR',
    urlLabel: 'Bild-URL (Pinterest/Google)',
    addLink: 'Per Link hinzufÃ¼gen',
    localLabel: 'Oder vom Computer hochladen',
    downloadBoard: 'Board-Screenshot herunterladen',
    goalGroups: 'Zielgruppen',
    boardPlaceholder: 'Deine Bilder erscheinen hier âœ¨',
    imageUrlPlaceholder: 'https://...'
  }
};

let currentLang = localStorage.getItem('vision-lang') || 'sr';
if (!translations[currentLang]) currentLang = 'sr';

function t(key) {
  return translations[currentLang][key] || key;
}

function applyTranslations() {
  document.documentElement.lang = currentLang;
  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.getAttribute('data-i18n');
    const value = t(key);
    if (value) el.textContent = value;
  });

  const input = document.getElementById('imageUrl');
  if (input) input.placeholder = t('imageUrlPlaceholder');

  const langSelect = document.getElementById('languageSelect');
  if (langSelect) langSelect.value = currentLang;
}

function setupLanguageSelect() {
  const langSelect = document.getElementById('languageSelect');
  if (!langSelect) return;

  langSelect.value = currentLang;
  langSelect.addEventListener('change', (event) => {
    currentLang = event.target.value;
    localStorage.setItem('vision-lang', currentLang);
    applyTranslations();
    if (typeof updateGroups === 'function') updateGroups();
  });
}

const board = document.getElementById('board');
const sizePreset = document.getElementById('sizePreset');
const category = document.getElementById('category');
const imageUrl = document.getElementById('imageUrl');
const addUrlBtn = document.getElementById('addUrl');
const localFile = document.getElementById('localFile');
const groupList = document.getElementById('groupList');
const downloadBoard = document.getElementById('downloadBoard');
const connectWallet = document.getElementById('connectWallet');
const walletStatus = document.getElementById('walletStatus');

if (connectWallet && walletStatus) {
  connectWallet.addEventListener('click', async () => {
    if (!window.ethereum) {
      walletStatus.textContent = t('walletNotFound');
      return;
    }

    try {
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      const wallet = accounts?.[0] || '';
      walletStatus.textContent = `${t('walletConnected')}: ${wallet.slice(0, 6)}...${wallet.slice(-4)}`;
    } catch {
      walletStatus.textContent = t('walletCanceled');
    }
  });
}

let updateGroups = null;

if (board && sizePreset && category && imageUrl && addUrlBtn && localFile && groupList && downloadBoard) {
  const counts = {
    putovanja: 0,
    posao: 0,
    ljubav: 0,
    star: 0,
  };

  updateGroups = function renderGroups() {
    groupList.innerHTML = `
      <li><strong>${t('catTravel')}</strong>: ${counts.putovanja}</li>
      <li><strong>${t('catWork')}</strong>: ${counts.posao}</li>
      <li><strong>${t('catLove')}</strong>: ${counts.ljubav}</li>
      <li><strong>${t('catStarShort')}</strong>: ${counts.star}</li>
    `;
  };

  function applySize(value) {
    const [w, h] = value.split('x').map(Number);
    const previewWidth = 760;
    const ratio = h / w;

    board.style.width = `${previewWidth}px`;
    board.style.height = `${Math.round(previewWidth * ratio)}px`;
  }

  function randomPosition() {
    const maxX = Math.max(10, board.clientWidth - 160);
    const maxY = Math.max(10, board.clientHeight - 160);
    return {
      x: Math.floor(Math.random() * maxX),
      y: Math.floor(Math.random() * maxY),
    };
  }

  function centerPosition() {
    return {
      x: Math.max(0, board.clientWidth / 2 - 75),
      y: Math.max(0, board.clientHeight / 2 - 75),
    };
  }

  function removePlaceholder() {
    const placeholder = board.querySelector('.board-placeholder');
    if (placeholder) {
      placeholder.remove();
    }
  }

  function makeDraggable(element) {
    let offsetX = 0;
    let offsetY = 0;
    let dragging = false;

    element.addEventListener('mousedown', (event) => {
      dragging = true;
      offsetX = event.clientX - element.offsetLeft;
      offsetY = event.clientY - element.offsetTop;
      element.style.cursor = 'grabbing';
    });

    window.addEventListener('mousemove', (event) => {
      if (!dragging) return;
      const x = event.clientX - offsetX;
      const y = event.clientY - offsetY;
      element.style.left = `${Math.max(0, Math.min(x, board.clientWidth - 150))}px`;
      element.style.top = `${Math.max(0, Math.min(y, board.clientHeight - 150))}px`;
    });

    window.addEventListener('mouseup', () => {
      dragging = false;
      element.style.cursor = 'grab';
    });
  }

  function addSticker(src) {
    if (!src) return;

    removePlaceholder();
    const tag = category.value;
    const img = document.createElement('img');
    img.src = src;
    img.className = 'sticker';
    img.alt = `${tag} inspiration`;

    const pos = tag === 'star' ? centerPosition() : randomPosition();
    img.style.left = `${pos.x}px`;
    img.style.top = `${pos.y}px`;

    board.appendChild(img);
    makeDraggable(img);

    counts[tag] += 1;
    updateGroups();
  }

  addUrlBtn.addEventListener('click', () => {
    addSticker(imageUrl.value.trim());
    imageUrl.value = '';
  });

  localFile.addEventListener('change', (event) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => addSticker(reader.result);
    reader.readAsDataURL(file);
    localFile.value = '';
  });

  sizePreset.addEventListener('change', () => {
    applySize(sizePreset.value);
  });

  downloadBoard.addEventListener('click', () => {
    window.print();
  });

  applySize(sizePreset.value);
  updateGroups();
}

setupLanguageSelect();
applyTranslations();
if (typeof updateGroups === 'function') updateGroups();
